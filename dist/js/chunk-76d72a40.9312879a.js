(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-76d72a40"],{2205:function(s,t,e){"use strict";e("851d")},"851d":function(s,t,e){},b556:function(s,t,e){"use strict";e.r(t);var i=function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"bx--grid"},[e("div",{staticClass:"bx--row"},[e("div",{staticClass:"bx--col"},[1===s.loadingPage.length?e("div",{staticClass:"bx--row"},[e("p",{staticStyle:{"padding-left":"1rem",cursor:"pointer"}},[s._v("Nenhum usuario conectado ")])]):s._l(s.loadingPage,(function(t){return e("div",{key:t.socketId,staticClass:"bx--row"},[t.user_id!==s.modalEdit?e("p",{staticStyle:{"padding-left":"1rem",cursor:"pointer"},attrs:{id:t.user_id},on:{click:function(e){return s.createRoom(t.user_id)}}},[s._v(" "+s._s(t.user_id)+" ")]):s._e()])}))],2),e("div",{staticClass:"bx--col"},s._l(s.listRoomComputed,(function(t,i){return e("div",{key:t,staticClass:"bx--row",staticStyle:{width:"17rem",border:"1px solid black","min-height":"17.5rem","max-height":"17.5rem","margin-top":"2rem"}},[e("div",{staticClass:"bx--col"},[e("div",{staticClass:"bx--row"},[e("div",{staticStyle:{width:"80%","padding-top":"0.5rem","padding-bottom":"0.5rem"},attrs:{lass:"bx--col--lg"}},[s._v("ID CHAT : "+s._s(t))]),e("div",{staticClass:"bx--col",staticStyle:{cursor:"pointer","font-size":"1.3rem"},on:{click:function(e){return s.minimizeChat(t,i)}}},[s._v(" x ")])]),e("div",{staticClass:"bx--row",staticStyle:{overflow:"auto","flex-direction":"column-reverse","min-height":"13.5rem","max-height":"13.5rem"}},[e("div",{staticClass:"bx--col"},s._l(s.messages,(function(i,a){return e("div",{key:a,staticClass:"bx--row"},[t===i.room?e("div",[e("div",[e("span",{staticClass:"message"},[s._v(s._s(i.from)+": "+s._s(i.message)+" ")])])]):s._e()])})),0)]),e("div",{staticClass:"bx--row"},[e("div",{staticClass:"chat-window",attrs:{id:t}},[e("div",{staticClass:"body"}),e("div",{staticClass:"footer"},[e("input",{directives:[{name:"model",rawName:"v-model",value:s.mensagemParticular[i],expression:"mensagemParticular[id]"}],staticClass:"messageText",staticStyle:{width:"13.7rem",height:"2rem"},attrs:{type:"text"},domProps:{value:s.mensagemParticular[i]},on:{keyup:function(e){return!e.type.indexOf("key")&&s._k(e.keyCode,"enter",13,e.key,"Enter")?null:s.sendMessage(t,i)},input:function(t){t.target.composing||s.$set(s.mensagemParticular,i,t.target.value)}}}),e("button",{staticStyle:{height:"2rem"},on:{click:function(e){return s.sendMessage(t,i)}}},[s._v("GO")])])])])])])})),0)])])},a=[],o=e("2f62"),r=e("bc3a"),m=e.n(r);const c=io({transports:["websocket"]});console.log("criar socket.io");var n={name:"chat",data(){return{messages:[],mensagemParticular:[],listRoom:[],chats:[],reconectar:[],toke:""}},computed:{...Object(o["c"])(["loadingPage","modalEdit","chamarChat"]),listRoomComputed:{get(){return this.listRoom}}},methods:{...Object(o["b"])(["setLoadingPage"]),async createRoom(s){if(console.log("Abri chat "),-1===this.chats.indexOf(s)){this.chats.push(s);let t=this.modalEdit,e="";e=this.modalEdit>s?this.modalEdit+s:s+this.modalEdit,this.listRoom.push(e),this.mensagemParticular.push("");let i={token:this.token,room:e},a=await m.a.post("/api/mensagens",i);a.data.length>0&&(this.messages=this.messages.concat(a.data)),c.emit("create",{room:e,userId:t.userId,withUserId:s,user:this.modalEdit})}},sendMessage(s,t){console.log("Enviar mensagem ");let e=this.modalEdit,i=this.mensagemParticular[t];this.mensagemParticular[t]="",c.emit("message",{room:s,message:i,from:e}),this.messages.push({room:s,message:i,from:e})},minimizeChat(s,t){this.listRoom.splice(t,1),this.chats.splice(t,1),this.messages=this.messages.filter(t=>t.room!==s)},criarUsuario(){""!==this.modalEdit?c.emit("loggedin",{user_id:this.modalEdit}):this.$router.push("/login")}},mounted(){this.token=this.$cookies.get("token"),this.criarUsuario(),this.createRoom(this.chamarChat)},created:function(){c.on("updateUserList",s=>{console.log("atualia√ßao de usuarios");for(let t=0;t<this.reconectar.length;t++)if(1===s[1].indexOf(this.reconectar[t])){console.log("preciso reconectar esse chat");let s="";s=this.modalEdit>this.chats[t]?this.modalEdit+this.chats[t]:this.chats[t]+this.modalEdit;let e=this.chats.indexOf(this.reconectar[t]);this.minimizeChat(s,e),this.createRoom(this.reconectar[t])}for(let t=0;t<this.chats.length;t++)if(-1===s[1].indexOf(this.chats[t])){let s="";s=this.modalEdit>this.chats[t]?this.modalEdit+this.chats[t]:this.chats[t]+this.modalEdit,-1===this.reconectar.indexOf(this.chats[t])&&(this.reconectar.push(this.chats[t]),this.messages.push({room:s,message:"Usuario esta off",from:"Automatica"}))}this.setLoadingPage(s[0])}),c.on("invite",s=>{console.log("chat foi aberto"),c.emit("joinRoom",s)}),c.on("message",async s=>{if(console.log("CHEGOU UMA MENSAGEM "),-1===this.listRoom.indexOf(s.room)){this.listRoom.push(s.room),this.chats.push(s.from);let t={token:this.token,room:s.room},e=await m.a.post("/api/mensagens",t);e.data.length>0&&(this.messages=this.messages.concat(e.data)),this.messages[this.messages.length-1]=delete this.messages[this.messages.length-1]["_id"],this.messages[this.messages.length-1]!=={room:s.room,message:s.message,from:s.from}&&this.messages.push({room:s.room,message:s.message,from:s.from})}else this.mensagemParticular.push(""),this.messages.push({room:s.room,message:s.message,from:s.from})})}},h=n,l=(e("2205"),e("2877")),d=Object(l["a"])(h,i,a,!1,null,null,null);t["default"]=d.exports}}]);
//# sourceMappingURL=chunk-76d72a40.9312879a.js.map
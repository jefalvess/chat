{"version":3,"sources":["webpack:///./src/components/timeline/chat.vue?68e0","webpack:///./src/components/timeline/chat.vue?fff3","webpack:///src/components/timeline/chat.vue","webpack:///./src/components/timeline/chat.vue?47cd","webpack:///./src/components/timeline/chat.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","slot","_v","_s","loadingPage","length","staticStyle","_l","user","key","socketId","user_id","modalEdit","attrs","on","$event","createRoom","_e","staticRenderFns","socket","io","console","log","name","messages","mensagemParticular","listRoom","chats","reconectar","toke","computed","listRoomComputed","methods","id","setChamarChat","$router","push","room","index","splice","filter","item","emit","token","$cookies","get","criarUsuario","created","response","i","indexOf","minimizeChat","message","from","setLoadingPage","data","async","msg","payload","concat","component"],"mappings":"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","file":"js/chunk-7d6de71f.4bccce91.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./chat.vue?vue&type=style&index=0&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"bx--grid\"},[_c('cv-accordion',{ref:\"acc\"},[_c('cv-accordion-item',[_c('template',{slot:\"title\"},[_vm._v(\"Usuarios conectados: \"+_vm._s(_vm.loadingPage.length - 1)+\" \")]),_c('template',{slot:\"content\"},[(_vm.loadingPage.length === 1)?_c('div',{staticClass:\"bx--row\"},[_c('p',{staticStyle:{\"padding-left\":\"1rem\",\"cursor\":\"pointer\"}},[_vm._v(\"Nenhum usuario conectado \")])]):_vm._l((_vm.loadingPage),function(user){return _c('div',{key:user.socketId,staticClass:\"bx--row\"},[(user.user_id !== _vm.modalEdit)?_c('p',{staticStyle:{\"padding-left\":\"1rem\",\"cursor\":\"pointer\"},attrs:{\"id\":user.user_id},on:{\"click\":function($event){return _vm.createRoom(user.user_id)}}},[_vm._v(\" \"+_vm._s(user.user_id)+\" \")]):_vm._e()])})],2)],2)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"bx--grid\" >\n\n     <cv-accordion ref=\"acc\">\n       <cv-accordion-item>\n        <template slot=\"title\">Usuarios conectados: {{ loadingPage.length - 1 }} </template>\n        <template slot=\"content\">\n            \n          <div class=\"bx--row\" v-if=\"loadingPage.length === 1\"> \n            <p style=\"padding-left: 1rem; cursor: pointer\">Nenhum usuario conectado  </p>\n          </div> \n\n              <!-- Lista de usuario conectados -->\n              <div  v-else class=\"bx--row\" v-for=\"user in loadingPage\" v-bind:key=\"user.socketId\">\n                <p\n                  v-if=\"user.user_id !== modalEdit\"\n                  v-bind:id=\"user.user_id\"\n                  v-on:click=\"createRoom(user.user_id)\"\n                  style=\"padding-left: 1rem; cursor: pointer\"\n                >\n                  {{ user.user_id }}\n                </p>\n               \n            </div>    \n          </template>\n      </cv-accordion-item>\n     </cv-accordion>\n    \n  </div>\n</template>\n\n<script>\nimport { mapGetters, mapActions } from 'vuex';\nimport axios from 'axios';\n// eslint-disable-next-line no-undef\nconst socket = io({ transports: ['websocket'] });\nconsole.log('criar socket.io');\n\nexport default {\n  name: 'chat',\n  data() {\n    return {\n      messages: [],\n      mensagemParticular: [],\n      listRoom: [],\n      chats: [],\n      reconectar: [],\n      toke: '',\n    };\n  },\n  computed: {\n    ...mapGetters(['loadingPage', 'modalEdit']),\n    listRoomComputed: {\n      get() {\n        return this.listRoom;\n      }\n    }\n  },\n  methods: {\n    ...mapActions(['setLoadingPage', 'setChamarChat']),\n    // Criar sala de bate papo\n    async createRoom(id) {\n      this.setChamarChat(id)\n      this.$router.push('/chat');\n    },\n    minimizeChat(room, index) {\n      this.listRoom.splice(index, 1);\n      this.chats.splice(index, 1);\n      this.messages = this.messages.filter(item => item.room !== room);\n    },\n    criarUsuario() {\n      if (this.modalEdit !== '') {\n        socket.emit('loggedin', { user_id: this.modalEdit });\n      } \n      \n    }\n  },\n  mounted() {\n    this.token = this.$cookies.get(\"token\")\n    this.criarUsuario();\n  },\n  created: function() {\n\n    // criar chat\n    socket.on('updateUserList', response => {\n      console.log('atualiaçao de usuarios');\n      // CHat que estava on e preciso reabrir conexao\n      for (let i = 0; i < this.reconectar.length; i++) {\n        // Se o chat aberto nao existir aqui\n        if (response[1].indexOf(this.reconectar[i]) === 1) {\n          console.log('preciso reconectar esse chat');\n\n          let room = '';\n          if (this.modalEdit > this.chats[i]) {\n            room = this.modalEdit + this.chats[i];\n          } else {\n            room = this.chats[i] + this.modalEdit;\n          }\n\n          let index = this.chats.indexOf(this.reconectar[i]);\n          this.minimizeChat(room, index);\n          this.createRoom(this.reconectar[i]);\n        }\n      }\n\n      // Avisar se alguem ficar of e eu tenho chat aberto;\n      for (let i = 0; i < this.chats.length; i++) {\n        // Se o chat aberto nao existir aqui\n        if (response[1].indexOf(this.chats[i]) === -1) {\n          let room = '';\n          if (this.modalEdit > this.chats[i]) {\n            room = this.modalEdit + this.chats[i];\n          } else {\n            room = this.chats[i] + this.modalEdit;\n          }\n    \n          // Primeira noticaçao para o chat\n          if (this.reconectar.indexOf(this.chats[i]) === -1 ) { \n            this.reconectar.push(this.chats[i]);\n            this.messages.push({\n              room: room,\n              message: 'Usuario esta off',\n              from: 'Automatica'\n            });\n          }\n        }\n      }\n\n      this.setLoadingPage(response[0]);\n    });\n\n    // chat foi aberto em outro lugar\n    socket.on('invite', data => {\n      console.log('chat foi aberto');\n      socket.emit('joinRoom', data);\n    });\n\n    // Onde chega as mensagens de outro remetente\n    socket.on('message', async msg => {\n      console.log('CHEGOU UMA MENSAGEM ');\n      if (this.listRoom.indexOf(msg.room) === -1) {\n        this.listRoom.push(msg.room);\n        this.chats.push(msg.from);\n        let payload = { token: this.token, room :  msg.room }\n        let response = await axios.post('/api/mensagens', payload );\n        if (response.data.length > 0) {\n          this.messages = this.messages.concat(response.data);\n        }\n\n        this.messages[this.messages.length - 1] = delete this.messages[\n          this.messages.length - 1\n        ]['_id'];\n\n        if (\n          this.messages[this.messages.length - 1] !==\n          { room: msg.room, message: msg.message, from: msg.from }\n        ) {\n          this.messages.push({\n            room: msg.room,\n            message: msg.message,\n            from: msg.from\n          });\n        }\n      } else {\n        this.mensagemParticular.push('');\n\n        this.messages.push({\n          room: msg.room,\n          message: msg.message,\n          from: msg.from\n        });\n      }\n    });\n  }\n};\n</script>\n\n<style>\n#pop{ \n  position:absolute;\n  top:50%;\n  left:50%;\n  margin-left:-150px;\n  margin-top:-100px;\n  padding:10px;\n  width:300px;\n  height:200px;\n  border:1px solid #d0d0d0;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./chat.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./chat.vue?vue&type=template&id=4f46e140&\"\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}